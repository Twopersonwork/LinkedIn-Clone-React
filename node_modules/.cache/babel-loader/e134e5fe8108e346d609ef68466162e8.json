{"ast":null,"code":"var __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n\n    return t;\n  };\n\n  return __assign.apply(this, arguments);\n};\n\nimport { ResizeObserver } from \"@juggle/resize-observer\";\nimport { useEnsuredRef } from \"../useEnsuredRef\";\nimport { useIsomorphicLayoutEffect } from \"../useIsomorphicLayoutEffect\";\nimport { useResizeObserverV1 } from \"./useResizeObserverV1\";\n/**\n * @internal\n */\n\nfunction isHeightChange(prevSize, nextSize) {\n  return !prevSize || prevSize.height !== nextSize.height || prevSize.scrollHeight !== nextSize.scrollHeight;\n}\n/**\n * @internal\n */\n\n\nfunction isWidthChange(prevSize, nextSize) {\n  return !prevSize || prevSize.width !== nextSize.width || prevSize.scrollWidth !== nextSize.scrollWidth;\n}\n/**\n * Why is there a single shared observer instead of multiple and a\n * \"subscription\" model?\n *\n * Note: Probably a bit of a premature optimization right now...\n *\n * @see https://github.com/WICG/resize-observer/issues/59\n * @internal\n */\n\n\nvar sharedObserver;\n/**\n *\n * @internal\n */\n\nvar subscriptions = [];\n/**\n * Lazy initializes the shared resize observer which will loop through all the\n * subscriptions when a resize event is called.\n *\n * @internal\n */\n\nfunction init() {\n  if (sharedObserver || typeof document === \"undefined\") {\n    return;\n  }\n\n  sharedObserver = new ResizeObserver(function (entries) {\n    var _loop_1 = function (i) {\n      var entry = entries[i];\n      var currentSubscriptions = subscriptions.filter(function (_a) {\n        var target = _a.target;\n        return target === entry.target;\n      });\n\n      if (!currentSubscriptions.length) {\n        return {\n          value: void 0\n        };\n      }\n\n      var _a = entry.contentRect,\n          height = _a.height,\n          width = _a.width;\n      var _b = entry.target,\n          scrollHeight = _b.scrollHeight,\n          scrollWidth = _b.scrollWidth;\n      var nextSize = {\n        height: height,\n        width: width,\n        scrollHeight: scrollHeight,\n        scrollWidth: scrollWidth\n      };\n\n      for (var j = 0; j < currentSubscriptions.length; j += 1) {\n        var subscription = currentSubscriptions[j];\n        var handler = subscription.handler,\n            prevSize = subscription.prevSize,\n            disableHeight = subscription.disableHeight,\n            disableWidth = subscription.disableWidth;\n        var isNewHeight = isHeightChange(prevSize, nextSize);\n        var isNewWidth = isWidthChange(prevSize, nextSize);\n\n        if (isNewHeight && !disableHeight || isNewWidth && !disableWidth) {\n          subscription.prevSize = nextSize;\n          handler(__assign(__assign({}, nextSize), {\n            element: entry.target\n          }));\n        }\n      }\n    }; // Note: might need to wait until an requestAnimationFrame has completed to\n    // fix the resize observer loop exceeded error if switching to\n    // `useIsomorphicLayoutEffect` and a shared observer didn't fix that error:\n    // https://stackoverflow.com/questions/49384120/resizeobserver-loop-limit-exceeded\n\n\n    for (var i = 0; i < entries.length; i += 1) {\n      var state_1 = _loop_1(i);\n\n      if (typeof state_1 === \"object\") return state_1.value;\n    }\n  });\n}\n/**\n *\n * @internal\n */\n\n\nfunction subscribe(target, onResize, disableHeight, disableWidth) {\n  var exists = subscriptions.find(function (sub) {\n    return sub.target === target;\n  });\n  subscriptions.push({\n    target: target,\n    handler: onResize,\n    disableWidth: disableWidth,\n    disableHeight: disableHeight,\n    prevSize: undefined\n  });\n\n  if (!exists) {\n    // I'll silently fail non-initialized observers for now until it becomes an\n    // issue... But how will I ever know?\n    sharedObserver === null || sharedObserver === void 0 ? void 0 : sharedObserver.observe(target);\n  }\n}\n/**\n *\n * @internal\n */\n\n\nfunction unsubscribe(target, onResize, disableHeight, disableWidth) {\n  var i = subscriptions.findIndex(function (sub) {\n    return sub.target === target && sub.handler === onResize && sub.disableWidth === disableWidth && sub.disableHeight === disableHeight;\n  });\n\n  if (i !== -1) {\n    subscriptions.splice(i, 1);\n  }\n\n  var remaining = subscriptions.some(function (sub) {\n    return sub.target === target;\n  });\n\n  if (!remaining) {\n    // I'll silently fail non-initialized observers for now until it becomes an\n    // issue... But how will I ever know?\n    sharedObserver === null || sharedObserver === void 0 ? void 0 : sharedObserver.unobserve(target);\n  }\n}\n/**\n * This is currently a version that supports the \"v1\" and \"v2\" behavior of the\n * resize observer. **This hook with crash if you switch between the v1 and v2\n * behavior** during runtime.\n *\n * Please migrate to the v2 behavior with the ref handler when possible.\n *\n * @remarks \\@since 2.3.0\n */\n\n\nexport function useResizeObserver(arg1, arg2) {\n  if (arg2 === void 0) {\n    arg2 = {};\n  } // the app **should** crash if the user is switching between v1 and v2 behavior\n\n  /* eslint-disable react-hooks/rules-of-hooks */\n\n\n  if (typeof arg1 !== \"function\") {\n    useResizeObserverV1(arg1);\n    return;\n  }\n\n  var onResize = arg1;\n  var propRef = arg2.ref,\n      _a = arg2.disableHeight,\n      disableHeight = _a === void 0 ? false : _a,\n      _b = arg2.disableWidth,\n      disableWidth = _b === void 0 ? false : _b;\n\n  var _c = useEnsuredRef(propRef),\n      ref = _c[0],\n      refHandler = _c[1];\n\n  useIsomorphicLayoutEffect(function () {\n    var target = ref.current;\n\n    if (disableHeight && disableWidth || !target) {\n      return;\n    }\n\n    init();\n    subscribe(target, onResize, disableHeight, disableWidth);\n    return function () {\n      unsubscribe(target, onResize, disableHeight, disableWidth);\n    };\n  }, [disableHeight, disableWidth, onResize]);\n  return [ref, refHandler];\n}","map":{"version":3,"sources":["../../src/sizing/useResizeObserver.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["var __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nimport { ResizeObserver } from \"@juggle/resize-observer\";\nimport { useEnsuredRef } from \"../useEnsuredRef\";\nimport { useIsomorphicLayoutEffect } from \"../useIsomorphicLayoutEffect\";\nimport { useResizeObserverV1, } from \"./useResizeObserverV1\";\n/**\n * @internal\n */\nfunction isHeightChange(prevSize, nextSize) {\n    return (!prevSize ||\n        prevSize.height !== nextSize.height ||\n        prevSize.scrollHeight !== nextSize.scrollHeight);\n}\n/**\n * @internal\n */\nfunction isWidthChange(prevSize, nextSize) {\n    return (!prevSize ||\n        prevSize.width !== nextSize.width ||\n        prevSize.scrollWidth !== nextSize.scrollWidth);\n}\n/**\n * Why is there a single shared observer instead of multiple and a\n * \"subscription\" model?\n *\n * Note: Probably a bit of a premature optimization right now...\n *\n * @see https://github.com/WICG/resize-observer/issues/59\n * @internal\n */\nvar sharedObserver;\n/**\n *\n * @internal\n */\nvar subscriptions = [];\n/**\n * Lazy initializes the shared resize observer which will loop through all the\n * subscriptions when a resize event is called.\n *\n * @internal\n */\nfunction init() {\n    if (sharedObserver || typeof document === \"undefined\") {\n        return;\n    }\n    sharedObserver = new ResizeObserver(function (entries) {\n        var _loop_1 = function (i) {\n            var entry = entries[i];\n            var currentSubscriptions = subscriptions.filter(function (_a) {\n                var target = _a.target;\n                return target === entry.target;\n            });\n            if (!currentSubscriptions.length) {\n                return { value: void 0 };\n            }\n            var _a = entry.contentRect, height = _a.height, width = _a.width;\n            var _b = entry.target, scrollHeight = _b.scrollHeight, scrollWidth = _b.scrollWidth;\n            var nextSize = {\n                height: height,\n                width: width,\n                scrollHeight: scrollHeight,\n                scrollWidth: scrollWidth,\n            };\n            for (var j = 0; j < currentSubscriptions.length; j += 1) {\n                var subscription = currentSubscriptions[j];\n                var handler = subscription.handler, prevSize = subscription.prevSize, disableHeight = subscription.disableHeight, disableWidth = subscription.disableWidth;\n                var isNewHeight = isHeightChange(prevSize, nextSize);\n                var isNewWidth = isWidthChange(prevSize, nextSize);\n                if ((isNewHeight && !disableHeight) || (isNewWidth && !disableWidth)) {\n                    subscription.prevSize = nextSize;\n                    handler(__assign(__assign({}, nextSize), { element: entry.target }));\n                }\n            }\n        };\n        // Note: might need to wait until an requestAnimationFrame has completed to\n        // fix the resize observer loop exceeded error if switching to\n        // `useIsomorphicLayoutEffect` and a shared observer didn't fix that error:\n        // https://stackoverflow.com/questions/49384120/resizeobserver-loop-limit-exceeded\n        for (var i = 0; i < entries.length; i += 1) {\n            var state_1 = _loop_1(i);\n            if (typeof state_1 === \"object\")\n                return state_1.value;\n        }\n    });\n}\n/**\n *\n * @internal\n */\nfunction subscribe(target, onResize, disableHeight, disableWidth) {\n    var exists = subscriptions.find(function (sub) { return sub.target === target; });\n    subscriptions.push({\n        target: target,\n        handler: onResize,\n        disableWidth: disableWidth,\n        disableHeight: disableHeight,\n        prevSize: undefined,\n    });\n    if (!exists) {\n        // I'll silently fail non-initialized observers for now until it becomes an\n        // issue... But how will I ever know?\n        sharedObserver === null || sharedObserver === void 0 ? void 0 : sharedObserver.observe(target);\n    }\n}\n/**\n *\n * @internal\n */\nfunction unsubscribe(target, onResize, disableHeight, disableWidth) {\n    var i = subscriptions.findIndex(function (sub) {\n        return sub.target === target &&\n            sub.handler === onResize &&\n            sub.disableWidth === disableWidth &&\n            sub.disableHeight === disableHeight;\n    });\n    if (i !== -1) {\n        subscriptions.splice(i, 1);\n    }\n    var remaining = subscriptions.some(function (sub) { return sub.target === target; });\n    if (!remaining) {\n        // I'll silently fail non-initialized observers for now until it becomes an\n        // issue... But how will I ever know?\n        sharedObserver === null || sharedObserver === void 0 ? void 0 : sharedObserver.unobserve(target);\n    }\n}\n/**\n * This is currently a version that supports the \"v1\" and \"v2\" behavior of the\n * resize observer. **This hook with crash if you switch between the v1 and v2\n * behavior** during runtime.\n *\n * Please migrate to the v2 behavior with the ref handler when possible.\n *\n * @remarks \\@since 2.3.0\n */\nexport function useResizeObserver(arg1, arg2) {\n    if (arg2 === void 0) { arg2 = {}; }\n    // the app **should** crash if the user is switching between v1 and v2 behavior\n    /* eslint-disable react-hooks/rules-of-hooks */\n    if (typeof arg1 !== \"function\") {\n        useResizeObserverV1(arg1);\n        return;\n    }\n    var onResize = arg1;\n    var propRef = arg2.ref, _a = arg2.disableHeight, disableHeight = _a === void 0 ? false : _a, _b = arg2.disableWidth, disableWidth = _b === void 0 ? false : _b;\n    var _c = useEnsuredRef(propRef), ref = _c[0], refHandler = _c[1];\n    useIsomorphicLayoutEffect(function () {\n        var target = ref.current;\n        if ((disableHeight && disableWidth) || !target) {\n            return;\n        }\n        init();\n        subscribe(target, onResize, disableHeight, disableWidth);\n        return function () {\n            unsubscribe(target, onResize, disableHeight, disableWidth);\n        };\n    }, [disableHeight, disableWidth, onResize]);\n    return [ref, refHandler];\n}\n//# sourceMappingURL=useResizeObserver.js.map"]},"metadata":{},"sourceType":"module"}